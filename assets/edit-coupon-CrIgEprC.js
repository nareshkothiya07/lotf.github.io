import{b1 as K,W as Q,u as X,ay as y,r as I,b as Z,b8 as A,cO as W,c as ee,j as e,B as k,T as M,aU as te,q as Y,J as ae,S as r,F as se,d as ne,aL as ie,G as u,l as p,aK as N,I as O,b0 as w,H as h,m as L,L as U,s as oe}from"./index-DSO9TgYq.js";import{d as v}from"./dayjs.min-pRfd56nx.js";import{e as re,S as ue}from"./coupon-DO8eO71b.js";import{A as V,D as H}from"./AdapterDayjs-DJXadXKJ.js";import"./Dialog-CPoUMqzk.js";const de=()=>({coupon_name:"",coupon_code:"",discount_type:"percentage",discount_amount:0,maximum_users:void 0,maximum_uses:void 0,set_minimum_amount:void 0,applicable_services:"",start_date:null,end_date:null,status:"active"});function _e(){const{id:x}=K(),b=Q(),t=X(),[E,C]=y.useState(!0),[B,$]=y.useState(null),[g,R]=y.useState(null),z=I.useMemo(()=>de(),[]),m=Z({initialValues:z,validationSchema:re(t),enableReinitialize:!0,onSubmit:async(i,{setSubmitting:j,setFieldError:c})=>{var d,o,_,D;try{const f={...i,start_date:(d=i.start_date)==null?void 0:d.format("YYYY-MM-DD"),end_date:(o=i.end_date)==null?void 0:o.format("YYYY-MM-DD"),discount_amount:Number(i.discount_amount),maximum_users:i.maximum_users?Number(i.maximum_users):null,maximum_uses:i.maximum_uses?Number(i.maximum_uses):null,set_minimum_amount:i.set_minimum_amount?Number(i.set_minimum_amount):null},n=await A.patch(`/api/v1/admin/coupon/${x}`,f);if(n.data&&n.data.success===!1){const J=n.data.message;W(J);return}ee(t.formatMessage({id:"finance.couponUpdated"})),b("/finance/coupons",{state:{refreshCoupons:!0}})}catch(f){const n=(D=(_=f==null?void 0:f.response)==null?void 0:_.data)==null?void 0:D.message;n&&n.includes("Coupon code already exists")?c("coupon_code",n):n&&n.includes("coupon_name")?c("coupon_name",n):n&&n.includes("discount")?c("discount_amount",n):n&&n.includes("date")?n.includes("start")?c("start_date",n):n.includes("end")&&c("end_date",n):W(n||t.formatMessage({id:"common.errorOccurred"}))}finally{j(!1)}}});I.useEffect(()=>{x&&G()},[x]);const G=async()=>{var i,j,c;try{C(!0);const d=await A.get(`/api/v1/admin/coupon/${x}`),o=(i=d==null?void 0:d.data)==null?void 0:i.data;if(!o)throw new Error("No coupon data received from API");const _={coupon_name:o.coupon_name||"",coupon_code:o.coupon_code||"",discount_type:o.discount_type||"percentage",discount_amount:o.discount_amount||0,maximum_users:o.maximum_users||void 0,maximum_uses:o.maximum_uses||void 0,set_minimum_amount:o.set_minimum_amount||void 0,applicable_services:o.applicable_services||"",start_date:o.start_date?v(o.start_date):null,end_date:o.end_date?v(o.end_date):null,status:o.status||"active"};R(_),m.setValues(_)}catch(d){$(((c=(j=d==null?void 0:d.response)==null?void 0:j.data)==null?void 0:c.message)||d.message||"Failed to fetch coupon data")}finally{C(!1)}},{errors:a,touched:s,handleSubmit:q,handleChange:S,values:l,isSubmitting:F,handleBlur:P,setFieldValue:T}=m;return E?e.jsx(k,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(M,{children:"Loading..."})}):B?e.jsxs(k,{sx:{mt:2},children:[e.jsx(te,{severity:"error",children:B}),e.jsx(Y,{sx:{mt:2},onClick:()=>b("/finance/coupons"),children:t.formatMessage({id:"common.back"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{custom:!0,links:[{title:t.formatMessage({id:"sidebar.coupons"}),to:"/finance/coupons"},{title:t.formatMessage({id:"finance.editCoupon"}),to:`/finance/edit-coupon/${x}`}]}),e.jsx(r,{direction:"row",marginBottom:"20px",spacing:2,alignItems:"center",children:e.jsx(M,{variant:"h2",children:t.formatMessage({id:"finance.editCoupon"})})}),e.jsx(se,{value:m,children:e.jsx(ne,{autoComplete:"off",noValidate:!0,onSubmit:q,children:e.jsx(ie,{title:t.formatMessage({id:"finance.couponInfo"}),subheader:t.formatMessage({id:"finance.editCouponSubtitle"}),children:e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(p,{fullWidth:!0,label:t.formatMessage({id:"finance.couponName"}),...m.getFieldProps("coupon_name"),error:!!(s.coupon_name&&a.coupon_name),helperText:s.coupon_name&&a.coupon_name})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(p,{fullWidth:!0,label:t.formatMessage({id:"finance.couponCode"}),...m.getFieldProps("coupon_code"),error:!!(s.coupon_code&&a.coupon_code),helperText:s.coupon_code&&a.coupon_code,placeholder:"SAVE20"})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsxs(N,{fullWidth:!0,error:!!(s.discount_type&&a.discount_type),children:[e.jsx(O,{id:"discount-type-label",children:t.formatMessage({id:"finance.discountType"})}),e.jsxs(w,{labelId:"discount-type-label",id:"discount_type",name:"discount_type",value:l.discount_type,onChange:S,onBlur:P,label:t.formatMessage({id:"finance.discountType"}),children:[e.jsx(h,{value:"percentage",children:t.formatMessage({id:"finance.percentage"})}),e.jsx(h,{value:"flat",children:t.formatMessage({id:"finance.flat"})})]}),s.discount_type&&a.discount_type&&e.jsx(L,{error:!0,children:a.discount_type})]})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(p,{fullWidth:!0,type:"number",label:t.formatMessage({id:"finance.discountAmount"}),...m.getFieldProps("discount_amount"),error:!!(s.discount_amount&&a.discount_amount),helperText:s.discount_amount&&a.discount_amount,InputProps:{endAdornment:e.jsx(M,{variant:"body2",color:"textSecondary",children:l.discount_type==="percentage"?"%":"$"})}})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(p,{fullWidth:!0,type:"number",label:t.formatMessage({id:"finance.maximumUsers"}),...m.getFieldProps("maximum_users"),error:!!(s.maximum_users&&a.maximum_users),helperText:s.maximum_users&&a.maximum_users||t.formatMessage({id:"finance.maximumUsersHelp"})})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(p,{fullWidth:!0,type:"number",label:t.formatMessage({id:"finance.maximumUses"}),...m.getFieldProps("maximum_uses"),error:!!(s.maximum_uses&&a.maximum_uses),helperText:s.maximum_uses&&a.maximum_uses||t.formatMessage({id:"finance.maximumUsesHelp"})})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(p,{fullWidth:!0,type:"number",label:t.formatMessage({id:"finance.minimumOrderAmount"}),...m.getFieldProps("set_minimum_amount"),error:!!(s.set_minimum_amount&&a.set_minimum_amount),helperText:s.set_minimum_amount&&a.set_minimum_amount||t.formatMessage({id:"finance.minimumOrderAmountHelp"})})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsxs(N,{fullWidth:!0,error:!!(s.status&&a.status),children:[e.jsx(O,{id:"status-label",children:t.formatMessage({id:"common.status"})}),e.jsxs(w,{labelId:"status-label",id:"status",name:"status",value:l.status,onChange:S,onBlur:P,label:t.formatMessage({id:"common.status"}),children:[e.jsx(h,{value:"active",children:t.formatMessage({id:"common.active"})}),e.jsx(h,{value:"inactive",children:t.formatMessage({id:"common.inactive"})}),e.jsx(h,{value:"expired",children:t.formatMessage({id:"common.expired"})})]}),s.status&&a.status&&e.jsx(L,{error:!0,children:a.status})]})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(U,{dateAdapter:V,children:e.jsx(H,{label:t.formatMessage({id:"finance.startDate"}),value:l.start_date,onChange:i=>T("start_date",i),minDate:g!=null&&g.start_date?g.start_date:void 0,slotProps:{textField:{fullWidth:!0,error:!!(s.start_date&&a.start_date),helperText:s.start_date&&a.start_date}}})})})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(r,{spacing:1,children:e.jsx(U,{dateAdapter:V,children:e.jsx(H,{label:t.formatMessage({id:"finance.endDate"}),value:l.end_date,onChange:i=>T("end_date",i),minDate:l.start_date??v().startOf("day"),slotProps:{textField:{fullWidth:!0,error:!!(s.end_date&&a.end_date),helperText:s.end_date&&a.end_date}}})})})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(r,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(Y,{variant:"outlined",onClick:()=>b("/finance/coupons"),disabled:F,children:t.formatMessage({id:"common.cancel"})}),e.jsx(oe,{type:"submit",variant:"contained",startIcon:e.jsx(ue,{}),loading:F,children:t.formatMessage({id:"common.update"})})]})})]})})})})]})}export{_e as default};
