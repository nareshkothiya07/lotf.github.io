import{Y as R,Z as b,$ as D,cd as p,u as N,r as S,W as J,b as O,c as v,cP as U,j as e,B as W,F as z,d as G,aL as I,G as m,S as M,I as B,l as C,m as P,n as u,cg as H,q as _,ax as E,s as Y,J as Z,U as K}from"./index-DSO9TgYq.js";import{a as Q,b as X,f as ee}from"./role-NGsUuE4A.js";const se=s=>R().shape({name:b().required(s.formatMessage({id:"common.validation.required"})),description:b(),modules:D().of(R().shape({role:b(),create:p(),edit:p(),view:p(),delete:p()}))}),te=()=>{const s=N(),[k,j]=S.useState(!1);J();const[y,L]=S.useState(!1),$=O({initialValues:{name:"",description:"",modules:[]},validationSchema:se(s),enableReinitialize:!0,onSubmit:async(i,{setSubmitting:t})=>{try{const o=[];i==null||i.modules.forEach(c=>{const{name:d,view:f,create:a,edit:g,delete:A,export:q}=c;f&&o.push(`view:${d}`),a&&o.push(`create:${d}`),g&&o.push(`edit:${d}`),A&&o.push(`delete:${d}`),q&&o.push(`export:${d}`)});const n={name:i.name,description:i.description,permissions:o};let r=localStorage.getItem("selectedRole");if(r){const c=JSON.parse(r);await Q(c==null?void 0:c.id,n).then(d=>{v(s.formatMessage({id:"roles.roleUpdateSuccess"})),t(!1),localStorage.removeItem("selectedRole"),location.href="/role/list"})}else await X(n).then(c=>{v(s.formatMessage({id:"roles.roleAddSuccess"})),t(!1),location.href="/role/list"})}catch(o){t(!1),console.error(o)}}});S.useEffect(()=>{j(!0),ee().then(i=>{var d;j(!1);const t=(d=i==null?void 0:i.data)==null?void 0:d.data;let o=localStorage.getItem("selectedRole"),n,r;o&&(r=JSON.parse(o),n=U(r==null?void 0:r.permissions),L(!0));const c=t.map(f=>{const a=n==null?void 0:n.find(g=>g.name===f.name);return{name:f.name||"",view:(a==null?void 0:a.view)||!1,create:(a==null?void 0:a.create)||!1,edit:(a==null?void 0:a.edit)||!1,delete:(a==null?void 0:a.delete)||!1,export:(a==null?void 0:a.export)||!1}});V({name:r==null?void 0:r.name,description:r==null?void 0:r.description,modules:c})}).finally(()=>{j(!1)})},[]);const{errors:l,touched:x,handleSubmit:T,handleChange:re,values:h,isSubmitting:w,setValues:V,handleBlur:oe,setFieldTouched:le,getFieldProps:F,setFieldValue:ie}=$;return e.jsx(W,{sx:{mb:5,mt:2},children:e.jsx(z,{value:$,children:e.jsxs(G,{autoComplete:"off",noValidate:!0,onSubmit:T,children:[e.jsx(I,{title:s.formatMessage({id:"roles.roleInformation"}),children:e.jsx(m,{container:!0,spacing:2,children:e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsxs(m,{item:!0,xs:12,sm:12,children:[e.jsxs(M,{spacing:1,children:[e.jsx(B,{htmlFor:"name",children:s.formatMessage({id:"roles.roleName"})}),e.jsx(C,{fullWidth:!0,id:"name",placeholder:s.formatMessage({id:"roles.roleName"}),...F("name"),error:!!(x.name&&l.name)})]}),x.name&&l.name&&e.jsx(P,{error:!0,id:"helper-name",children:l==null?void 0:l.name})]}),e.jsxs(m,{item:!0,xs:12,sm:12,children:[e.jsxs(M,{spacing:1,children:[e.jsx(B,{htmlFor:"description",children:s.formatMessage({id:"roles.roleDescription"})}),e.jsx(C,{fullWidth:!0,multiline:!0,rows:2,id:"description",placeholder:s.formatMessage({id:"roles.roleDescription"}),...F("description"),error:!!(x.description&&l.description)})]}),x.description&&l.description&&e.jsx(P,{error:!0,id:"helper-description",children:l==null?void 0:l.description})]})]})})})}),e.jsx("br",{}),e.jsx(I,{title:s.formatMessage({id:"roles.rolePermission"}),children:e.jsx(m,{container:!0,spacing:2,children:e.jsx(m,{item:!0,xs:12,sm:12,children:e.jsxs("table",{className:"my-table",children:[e.jsxs("tr",{children:[e.jsx("th",{children:"System criteria"}),e.jsx("th",{children:"View"}),e.jsx("th",{children:"Create"}),e.jsx("th",{children:"Edit"}),e.jsx("th",{children:"Delete"}),e.jsx("th",{children:"Eport CSV"})]}),!k&&h.modules.map((i,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(u,{name:`modules.${t}.name`,type:"text",readOnly:!0,style:{border:"none",background:"transparent",fontSize:"14px"}})}),e.jsx("td",{children:e.jsx(u,{name:`modules.${t}.view`,type:"checkbox",checked:h.modules[t].view})}),e.jsx("td",{children:e.jsx(u,{name:`modules.${t}.create`,type:"checkbox",checked:h.modules[t].create})}),e.jsx("td",{children:e.jsx(u,{name:`modules.${t}.edit`,type:"checkbox",checked:h.modules[t].edit})}),e.jsx("td",{children:e.jsx(u,{name:`modules.${t}.delete`,type:"checkbox",checked:h.modules[t].delete})}),e.jsx("td",{children:e.jsx(u,{name:`modules.${t}.export`,type:"checkbox",checked:h.modules[t].export})})]},t)),k&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",padding:"20px"},children:e.jsx(H,{})})})]})})})}),e.jsxs(M,{direction:"row",sx:{mt:2},justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(_,{variant:"outlined",component:E,to:"/role/list",disabled:w,children:s.formatMessage({id:"common.cancel"})}),e.jsx(Y,{type:"submit",loading:w,loadingIndicator:s.formatMessage({id:"common.processing"}),variant:"contained",children:y?s.formatMessage({id:"roles.editRole"}):s.formatMessage({id:"roles.addRole"})})]})]})})})};function ae(s){return[{title:s.formatMessage({id:"sidebar.home"}),to:K},{title:s.formatMessage({id:"sidebar.roles"}),to:"/role/list"},{title:s.formatMessage({id:"roles.addNewRole"})}]}const ne=()=>{const s=N();return e.jsxs("div",{children:[e.jsx(Z,{custom:!0,heading:s.formatMessage({id:"roles.addNewRole"}),links:ae(s)}),e.jsx(te,{})]})};export{ne as default};
