import{t as X,u as $,r as u,b as Z,b2 as ee,j as e,C as te,F as se,L as ae,A as ne,d as ie,D as oe,e as w,f as re,G as M,S as i,I as V,aK as G,b0 as Y,H as h,p as le,B as W,q as A,x as z,b6 as ce,T as p,W as de,a as me,v as ue,c as pe,i as q,X as J,y as he,z as ge,M as xe,E as je,cC as fe,J as ye,K as Ce,U as Me}from"./index-DSO9TgYq.js";import{d as be}from"./dayjs.min-pRfd56nx.js";import{D as Se}from"./DebouncedInput-DhmfX_1V.js";import{c as Fe,d as _e}from"./consultations-DReYVU28.js";import{R as Te}from"./RenderConsultationType-B0EO_Tu5.js";import{R as Ie}from"./RenderConsultationStatus-D5pOsWlB.js";import{R as Ae}from"./RenderFilterKeys-DXC0MC7n.js";import{u as Pe}from"./useFilterAndSearch-PJD0Zg8P.js";import{u as Q}from"./useStatusList-Dbp-x5Xm.js";import{f as H}from"./consultation-B8vXld6y.js";import{a as ke}from"./specialty-CpBsygzZ.js";import{G as ve}from"./GenericAutocomplete-D3M5FyqM.js";import{h as Ee}from"./handleScroll-BwFQoF1o.js";import{C as L}from"./CustomTypography-CRnDvUFn.js";import{F as De}from"./FilterDialog-D5JU5uJB.js";import{C as Oe}from"./ConfirmationDialog-DR_Ho8RD.js";import{F as Ne}from"./FilterOutlined-DlgxAz6z.js";import{A as Re}from"./ArrowUpOutlined-C9GTlrEN.js";import"./CloseOutlined-DRBnXhIJ.js";import"./doctor-Ca9o3VsJ.js";import"./RenderGender-B7FOG7SF.js";import"./useGenderList-C-bU5Ya0.js";import"./Autocomplete-BOe_mB7V.js";import"./doctor-9YdFtdUi.js";import"./regex-AjllrUCH.js";import"./Dialog-CPoUMqzk.js";function Le({open:d,initialValue:g,resetFilter:b,handleClose:m,setCriteria:P}){var s,a;const{lang:k}=X(),o=$(),[v,n]=u.useState([]),{statusList:f}=Q(z.CONSULTATION_STATUS),{statusList:x}=Q(z.CONSULTATION_TYPE),{data:j,isLoading:E,setPagination:C,setFilterCriteria:S}=ke(ce.FIFTY),y=u.useMemo(()=>H.cast(g),[H]),D=Z({initialValues:y,validationSchema:H,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:l})=>{try{const r={...(t==null?void 0:t.consultation_type)&&{consultation_type:t.consultation_type},...(t==null?void 0:t.speciality_id)&&{speciality_id:t.speciality_id},...typeof(t==null?void 0:t.status)=="number"&&{status:t.status}};if(Object.keys(r).length===0)return;P(r),m()}catch(r){console.error(r)}}}),K=()=>{b(),U(),m()},F=t=>{Ee(t,{isLoading:E,responseMeta:j.meta,setPagination:C})};u.useEffect(()=>{var t;(t=j==null?void 0:j.data)!=null&&t.length&&ee(j,v,n)},[j]);const{handleSubmit:B,isSubmitting:O,values:N,resetForm:U,setFieldValue:R}=D;return e.jsx(e.Fragment,{children:d&&e.jsx(te,{open:d,handleClose:m,maxWidth:550,children:e.jsx(se,{value:D,children:e.jsx(ae,{dateAdapter:ne,children:e.jsxs(ie,{autoComplete:"off",noValidate:!0,onSubmit:B,children:[e.jsx(oe,{children:o.formatMessage({id:"doctor.consultationTab.filterTitle"})}),e.jsx(w,{}),e.jsx(re,{sx:{p:2.5},children:e.jsxs(M,{container:!0,spacing:1,children:[e.jsx(M,{item:!0,xs:12,md:12,children:e.jsxs(i,{spacing:1,children:[e.jsx(V,{htmlFor:"status",children:o.formatMessage({id:"doctor.consultationTab.consultationStatus"})}),e.jsx(G,{fullWidth:!0,children:e.jsxs(Y,{id:"status",displayEmpty:!0,value:N.status,onChange:t=>R("status",t.target.value),children:[e.jsx(h,{value:"",children:e.jsx("em",{children:o.formatMessage({id:"common.none"})})}),(s=f==null?void 0:f.content)==null?void 0:s.map(t=>e.jsx(h,{value:t.value,children:t.label[k]},t.value))]})})]})}),e.jsx(M,{item:!0,xs:12,md:12,children:e.jsxs(i,{spacing:1,children:[e.jsx(V,{htmlFor:"consultation_type",children:o.formatMessage({id:"common.type"})}),e.jsx(G,{fullWidth:!0,children:e.jsxs(Y,{id:"consultation_type",displayEmpty:!0,value:N.consultation_type,onChange:t=>R("consultation_type",t.target.value),children:[e.jsx(h,{value:"",children:e.jsx("em",{children:o.formatMessage({id:"common.none"})})}),(a=x==null?void 0:x.content)==null?void 0:a.map(t=>e.jsx(h,{value:t.value,children:t.label[k]},t.value))]})})]})}),e.jsx(M,{item:!0,xs:12,md:12,children:e.jsxs(i,{spacing:1,children:[e.jsx(V,{htmlFor:"speciality_id",children:o.formatMessage({id:"common.specialty"})}),e.jsx(G,{fullWidth:!0,children:e.jsx(ve,{label:o.formatMessage({id:"common.selectOp"}),fieldId:"speciality_id",options:v,isLoading:E,fieldName:"speciality_name",onSearch:t=>S({...(t==null?void 0:t.length)>0&&{search:t}}),onScroll:F})})]})})]})}),e.jsx(w,{}),e.jsx(le,{sx:{p:2.5},children:e.jsx(M,{container:!0,justifyContent:"right",alignItems:"center",children:e.jsx(M,{item:!0,md:12,children:e.jsxs(W,{display:"flex",justifyContent:"space-between",children:[e.jsx(A,{color:"secondary",onClick:()=>K(),children:o.formatMessage({id:"common.clearAllFilters"})}),e.jsxs(i,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(A,{color:"error",onClick:m,children:o.formatMessage({id:"common.cancel"})}),e.jsx(A,{type:"submit",variant:"contained",disabled:O,children:o.formatMessage({id:"common.apply"})})]})]})})})})]})})})})})}function Ke({open:d,handleClose:g,handleSubmit:b}){const m=$();return e.jsx(Oe,{title:m.formatMessage({id:"common.cancelConsultation"}),open:d,handleClose:g,handleSubmit:b,actionTitle:m.formatMessage({id:"common.cancelConsultation"}),styles:{width:"600px"},children:e.jsx(i,{spacing:1,children:e.jsx(p,{children:m.formatMessage({id:"common.cancelConfirmation"})})})})}function Be(d){return[{title:d.formatMessage({id:"sidebar.home"}),to:Me},{title:d.formatMessage({id:"sidebar.consultations"}),to:"/services/home"}]}function ut(){const{lang:d}=X(),g=de(),{data:b,isLoading:m,url:P,setSorting:k,setPagination:o,setFilterCriteria:v}=Fe(),n=$(),[f,x]=u.useState(0),j=me(),E=ue(j.breakpoints.down("sm")),[C,S]=u.useState(!1),{filter:y,search:D,setSearch:K,onResetHandler:F,onRemoveFilterHandler:B,onFilterHandler:O}=Pe();u.useEffect(()=>{v(y)},[y]);const N=u.useCallback(async()=>{try{await _e(f,P).then(()=>{pe(n.formatMessage({id:"common.cancelAlert"})),x(0)})}catch{x(0)}},[f,P,n]),U=u.useCallback((s,a)=>{g(`/consultations/${s}`,{state:a})},[g]),R=u.useMemo(()=>[{header:n.formatMessage({id:"common.type"}),accessorKey:"consultation_type",cell:({row:s})=>{var a;return e.jsx(Te,{type:(a=s.original)==null?void 0:a.consultation_type})}},{header:n.formatMessage({id:"common.patient"}),accessorKey:"patient",enableSorting:!1,cell:({row:s})=>{var a,t,l,r;return e.jsxs(i,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(q,{alt:"Avatar 1",size:"sm",src:(t=(a=s.original)==null?void 0:a.patient)==null?void 0:t.photo}),e.jsxs(i,{spacing:0,children:[e.jsx(L,{className:"typography-inline",value:(l=s.original.patient)==null?void 0:l.name[d]}),e.jsx(L,{className:"typography-inline",value:J((r=s.original.patient)==null?void 0:r.phone_number)})]})]})}},{header:n.formatMessage({id:"common.doctor"}),accessorKey:"doctor",enableSorting:!1,cell:({row:s})=>{var a,t,l,r,_;return e.jsxs(i,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(q,{alt:"Avatar 1",size:"sm",src:(t=(a=s.original)==null?void 0:a.doctor)==null?void 0:t.photo}),e.jsxs(i,{spacing:0,children:[((l=s.original.doctor)==null?void 0:l.name)&&e.jsx(L,{className:"typography-inline",value:(r=s.original.doctor)==null?void 0:r.name[d]}),e.jsx(L,{className:"typography-inline",value:J((_=s.original.doctor)==null?void 0:_.phone_number)})]})]})}},{header:n.formatMessage({id:"common.status"}),accessorKey:"status",cell:s=>e.jsx(Ie,{status:s.getValue()})},{header:n.formatMessage({id:"common.totalPrice"}),accessorKey:"price",cell:({row:s})=>{var a,t;return`${(a=s.original)==null?void 0:a.price} ${(t=s==null?void 0:s.original)==null?void 0:t.currency}`}},{header:n.formatMessage({id:"common.consultationOn"}),accessorKey:"consultation_date",cell:({row:s})=>{var a,t,l;return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:be((a=s.original)==null?void 0:a.consultation_date).format(he)}),((t=s.original)==null?void 0:t.start_time)&&e.jsxs(p,{children:["at Â ",(l=s.original)==null?void 0:l.start_time]})]})}},{header:n.formatMessage({id:"common.actions"}),accessorKey:"Actions",meta:{className:"cell-center"},enableSorting:!1,cell:({row:s})=>{const[a,t]=u.useState(null),l=!!a,r=c=>{t(c.currentTarget)},_=()=>{t(null)};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{onClick:r,children:e.jsx(xe,{})}),e.jsxs(je,{anchorEl:a,open:l,onClose:_,onClick:_,children:[e.jsx(h,{onClick:c=>{c.stopPropagation(),U(s.original.id,s.original)},children:e.jsx(p,{variant:"body1",children:n.formatMessage({id:"common.consultation"})})}),e.jsx(h,{onClick:c=>{var T,I;c.stopPropagation(),g(`/patients/${(I=(T=s.original)==null?void 0:T.patient)==null?void 0:I.id}`)},children:e.jsx(p,{variant:"body1",children:n.formatMessage({id:"patient.patientProfile"})})}),e.jsx(h,{onClick:c=>{var T,I;c.stopPropagation(),g(`/doctor/${(I=(T=s.original)==null?void 0:T.doctor)==null?void 0:I.id}`)},children:e.jsx(p,{variant:"body1",children:n.formatMessage({id:"doctor.doctorProfile"})})}),e.jsx(h,{onClick:c=>{c.stopPropagation()},children:e.jsx(p,{variant:"body1",children:n.formatMessage({id:"consultations.transactionDetails"})})}),s.original.status!==fe.Cancelled&&e.jsx(h,{onClick:c=>{c.stopPropagation(),x(s.original.id)},children:e.jsx(p,{variant:"body1",children:n.formatMessage({id:"common.cancelConsultation"})})})]})]})}}],[]);return e.jsxs(e.Fragment,{children:[e.jsx(ye,{custom:!0,links:Be(n)}),e.jsx(i,{direction:"row",marginBottom:"20px",spacing:2,justifyContent:"space-between",alignItems:"center",children:e.jsx(p,{variant:"h2",children:n.formatMessage({id:"sidebar.consultations"})})}),e.jsxs(Ce,{data:b,columns:R,isLoading:m,setPagination:s=>{o(s)},setSortingParams:s=>{k(s)},children:[e.jsxs(i,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",sx:{px:2,paddingTop:2,...E&&{"& .MuiOutlinedInput-root, & .MuiFormControl-root":{width:"100%"}}},children:[e.jsx(W,{sx:{width:{xs:"70%",md:"70%"}},children:e.jsxs(i,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Se,{value:D,onFilterChange:s=>K(s),placeholder:n.formatMessage({id:"consultations.searchPlaceholder"})}),e.jsx(A,{variant:"contained",onClick:()=>S(!0),startIcon:e.jsx(Ne,{}),children:n.formatMessage({id:"common.filter"})})]})}),e.jsx(i,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{width:{xs:"100%",sm:"auto"}},children:e.jsx(i,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(A,{variant:"outlined",startIcon:e.jsx(Re,{}),children:n.formatMessage({id:"common.export"})})})})]}),e.jsx(W,{sx:{px:2,pt:2,pb:1},children:e.jsx(Ae,{params:y,onClearFilter:F,onRemoveFilter:B,referenceKey:z.CONSULTATION_STATUS})})]}),C&&e.jsx(Le,{open:C,initialValue:y,handleClose:()=>{S(!1)},setCriteria:O,resetFilter:F}),C&&e.jsx(De,{open:C,isDoctorList:!0,initialValue:y,handleClose:()=>{S(!1)},setCriteria:O,resetFilter:F}),e.jsx(Ke,{open:!!f,handleSubmit:N,handleClose:()=>{x(0)}})]})}export{ut as default};
