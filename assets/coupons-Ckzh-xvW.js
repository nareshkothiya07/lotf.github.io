import{ab as L,ao as $,ad as H,T as C,c0 as W,r as i,ae as z,a2 as q,j as e,a0 as R,a1 as G,aa as J,u as Q,W as V,aO as Y,a as X,v as Z,b8 as ee,c as se,cO as te,be as oe,y as ae,B as D,z as ne,M as re,E as ie,H as F,J as ce,S as p,q as h,ax as le,K as de,x as me,D as ue,f as pe,p as ge,U as fe}from"./index-DSO9TgYq.js";import{d as xe}from"./dayjs.min-pRfd56nx.js";import{c as he}from"./finance-FNhwWqHi.js";import{D as Ce}from"./DebouncedInput-DhmfX_1V.js";import{u as je}from"./useFilterAndSearch-PJD0Zg8P.js";import{R as Me}from"./RenderFilterKeys-DXC0MC7n.js";import{D as ye}from"./Dialog-CPoUMqzk.js";import{P as De}from"./PlusOutlined-BQvVSxI0.js";import{A as be}from"./ArrowUpOutlined-C9GTlrEN.js";import"./CloseOutlined-DRBnXhIJ.js";import"./doctor-Ca9o3VsJ.js";import"./specialty-CpBsygzZ.js";import"./RenderConsultationType-B0EO_Tu5.js";import"./useStatusList-Dbp-x5Xm.js";import"./RenderGender-B7FOG7SF.js";import"./useGenderList-C-bU5Ya0.js";function Te(o){return L("MuiDialogContentText",o)}$("MuiDialogContentText",["root"]);const Se=["children","className"],we=o=>{const{classes:c}=o,d=J({root:["root"]},Te,c);return R({},c,d)},ve=H(C,{shouldForwardProp:o=>W(o)||o==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(o,c)=>c.root})({}),Ee=i.forwardRef(function(c,g){const d=z({props:c,name:"MuiDialogContentText"}),{className:j}=d,f=q(d,Se),l=we(f);return e.jsx(ve,R({component:"p",variant:"body1",color:"text.secondary",ref:g,ownerState:f,className:G(l.root,j)},d,{classes:l}))}),Fe=Ee;function Re(o){return[{title:o.formatMessage({id:"sidebar.home"}),to:fe},{title:o.formatMessage({id:"sidebar.coupons"})}]}function Je(){const{data:o,isLoading:c,setFilterCriteria:g,url:d,setPagination:j,setSorting:f,refreshCoupons:l}=he(),t=Q(),m=V(),x=Y(),n=X(),I=Z(n.breakpoints.down("sm")),[b,M]=i.useState(0),[_,u]=i.useState(!1),{filter:y,search:k,setSearch:A,onResetHandler:O,onRemoveFilterHandler:P,onFilterHandler:Ie}=je();i.useEffect(()=>{g(y)},[y]),i.useEffect(()=>{var s;(s=x.state)!=null&&s.refreshCoupons&&(l(),m(x.pathname,{replace:!0,state:{}}))},[x.state,l,m,x.pathname]);const T=i.useCallback(s=>{m(`/finance/edit-coupon/${s.id}`)},[m]),S=i.useCallback(s=>{M(s.id),u(!0)},[]),U=i.useCallback(async()=>{var s,r;try{await ee.delete(`/api/v1/admin/coupon/${b}`),se(t.formatMessage({id:"finance.deleteSuccess"})),M(0),u(!1),l()}catch(a){te(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)||t.formatMessage({id:"common.errorOccurred"})),M(0),u(!1)}},[b,t,l]),K=i.useMemo(()=>[{header:t.formatMessage({id:"finance.couponName"}),accessorKey:"coupon_name"},{header:t.formatMessage({id:"finance.couponCode"}),accessorKey:"coupon_code"},{header:t.formatMessage({id:"common.discount"}),accessorKey:"discount_amount",cell:({row:s})=>{const r=s.original.discount_type,a=s.original.discount_amount;return r==="flat"?`${a} ${oe}`:`${a}%`}},{header:t.formatMessage({id:"finance.endDate"}),accessorKey:"end_date",cell:({row:s})=>xe(s.original.end_date).format(ae)},{header:t.formatMessage({id:"common.status"}),accessorKey:"status",cell:({row:s})=>{const r=s.original.status,a=(()=>{switch(r){case"active":return{bg:n.palette.success.lighter,color:n.palette.success.main};case"inactive":return{bg:n.palette.error.lighter,color:n.palette.error.main};case"expired":return{bg:n.palette.warning.lighter,color:n.palette.warning.main};default:return{bg:n.palette.grey[200],color:n.palette.text.primary}}})();return e.jsx(D,{sx:{display:"inline-flex",alignItems:"center",px:1.5,py:.5,borderRadius:1,backgroundColor:a.bg,color:a.color,fontSize:"0.75rem",fontWeight:600,textTransform:"capitalize"},children:t.formatMessage({id:`common.${r}`})})}},{header:t.formatMessage({id:"common.actions"}),accessorKey:"Actions",meta:{className:"cell-center"},enableSorting:!1,cell:({row:s})=>{const r=s.original,[a,w]=i.useState(null),B=!!a,N=E=>{E.stopPropagation(),w(E.currentTarget)},v=()=>{w(null)};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{onClick:N,size:"small",children:e.jsx(re,{})}),e.jsxs(ie,{anchorEl:a,open:B,onClose:v,onClick:v,children:[e.jsx(F,{onClick:()=>T(r),children:e.jsx(C,{variant:"body1",children:t.formatMessage({id:"common.edit"})})}),e.jsx(F,{onClick:()=>S(r),children:e.jsx(C,{variant:"body1",children:t.formatMessage({id:"common.delete"})})})]})]})}}],[t,m,T,S,n]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{custom:!0,links:Re(t)}),e.jsxs(p,{direction:"row",marginBottom:"20px",spacing:2,justifyContent:"space-between",alignItems:"center",children:[e.jsx(C,{variant:"h2",children:t.formatMessage({id:"sidebar.coupons"})}),e.jsx(h,{variant:"contained",startIcon:e.jsx(De,{}),component:le,to:"/finance/create-coupon",children:t.formatMessage({id:"finance.createCoupon"})})]}),e.jsxs(de,{data:o,columns:K,isLoading:c,setPagination:s=>j(s),setSortingParams:s=>f(s),children:[e.jsxs(p,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",sx:{px:2,paddingTop:2,...I&&{"& .MuiOutlinedInput-root, & .MuiFormControl-root":{width:"100%"}}},children:[e.jsx(D,{sx:{width:{xs:"70%",md:"70%"}},children:e.jsx(p,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(Ce,{value:k,onFilterChange:s=>A(s),placeholder:t.formatMessage({id:"finance.searchCoupons"})})})}),e.jsx(p,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{width:{xs:"100%",sm:"auto"}},children:e.jsx(p,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(h,{variant:"outlined",startIcon:e.jsx(be,{}),children:t.formatMessage({id:"common.export"})})})})]}),e.jsx(D,{sx:{px:2,pt:2,pb:1},children:e.jsx(Me,{params:y,onClearFilter:O,onRemoveFilter:P,referenceKey:me.DOCTOR_STATUS})})]}),e.jsxs(ye,{open:_,onClose:()=>u(!1),children:[e.jsx(ue,{children:t.formatMessage({id:"finance.confirmDeleteCoupon"})}),e.jsx(pe,{children:e.jsx(Fe,{children:t.formatMessage({id:"finance.deleteCouponWarning"})})}),e.jsxs(ge,{children:[e.jsx(h,{onClick:()=>u(!1),children:t.formatMessage({id:"common.cancel"})}),e.jsx(h,{onClick:U,color:"error",variant:"contained",children:t.formatMessage({id:"common.delete"})})]})]})]})}export{Je as default};
