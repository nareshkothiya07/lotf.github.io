import{a as Q,u as $,t as X,r as d,g as re,b as ce,bK as Y,c as k,j as e,C as oe,F as de,L as le,A as me,d as ue,D as he,e as q,f as pe,G as u,S as o,h as ge,i as Z,B as ee,k as xe,T as b,l as v,m as _,I as S,aK as je,b0 as _e,H as T,p as fe,q as z,s as ve,x as ie,v as Se,w as V,R as Me,y as ye,z as Ce,M as be,E as Ae,J as Ie,K as Fe,aL as Te,U as Be}from"./index-DSO9TgYq.js";import{d as Ee}from"./dayjs.min-pRfd56nx.js";import{D as we}from"./DebouncedInput-DhmfX_1V.js";import{f as De}from"./services-DCcxZZqT.js";import{C as Pe}from"./CameraOutlined-D4Mj0cXe.js";import{u as ke}from"./useStatusList-Dbp-x5Xm.js";import{a as Ne}from"./services-BGkrpTaC.js";import{u as G,a as Oe,b as Re,d as Ve}from"./sub-services-Cm3yL5Hw.js";import{D as Ke}from"./DeleteConfirmation-BqFOMagf.js";import{D as Le,A as We}from"./ActivateServiceConfirmation-DBGR9riN.js";import{u as Ue}from"./useFilterAndSearch-PJD0Zg8P.js";import{C as J}from"./CustomTypography-CRnDvUFn.js";import{P as ze}from"./PlusOutlined-BQvVSxI0.js";import{A as Ge}from"./ArrowUpOutlined-C9GTlrEN.js";import"./CloseOutlined-DRBnXhIJ.js";import"./ConfirmationDialog-DR_Ho8RD.js";import"./Dialog-CPoUMqzk.js";const He=t=>{var A,M,g,y;const m={name_en:"",name_ar:"",description_en:"",description_ar:"",min_visit_price:"",min_service_price:"",discount:"",status:1,image:""};return t?{name_en:(A=t==null?void 0:t.name)==null?void 0:A.en,name_ar:(M=t==null?void 0:t.name)==null?void 0:M.ar,description_en:((g=t==null?void 0:t.description)==null?void 0:g.en)||"",description_ar:((y=t==null?void 0:t.description)==null?void 0:y.ar)||"",min_visit_price:Number(t==null?void 0:t.min_visit_price),min_service_price:Number(t==null?void 0:t.min_service_price),discount:Number(t==null?void 0:t.discount),status:t==null?void 0:t.status,image:t==null?void 0:t.image}:m};function qe({serviceId:t,subService:m,url:A,open:M,handleClose:g}){const y=Q(),a=$(),{defaultList:h}=ke(ie.PACKAGE_STATUS),{lang:r}=X(),[C,N]=d.useState(void 0),[B,K]=d.useState(`${m&&(m!=null&&m.image)?m.image:""}`);d.useEffect(()=>{C&&(K(URL.createObjectURL(C)),re(C,n=>{O("image",n)}))},[C]);const L=d.useMemo(()=>He(m),[]),E=ce({initialValues:L,validationSchema:Ne(a),enableReinitialize:!0,onSubmit:async(n,{setSubmitting:f})=>{try{let l={...n,service_type:Y.VACCINATION,service_id:t,name:{en:n==null?void 0:n.name_en,ar:n==null?void 0:n.name_ar},description:{en:n==null?void 0:n.description_en,ar:n==null?void 0:n.description_ar}};(l.discount===""||l.discount===null||l.discount===void 0)&&(l.discount=0),l.image.includes("http")&&!C&&delete l.image,delete l.name_en,delete l.name_ar,delete l.description_en,delete l.description_ar,m?await G(m.id,l,A).then(U=>{k(a.formatMessage({id:"services.vaccination.editSuccess"})),f(!1),g()}):await Oe(l,A).then(U=>{k(a.formatMessage({id:"services.vaccination.addSuccess"})),f(!1),g()})}catch{f(!1)}}}),{errors:i,touched:c,handleSubmit:w,isSubmitting:I,getFieldProps:p,values:F,setFieldTouched:W,setFieldValue:O}=E;return e.jsx(e.Fragment,{children:M&&e.jsx(oe,{open:M,handleClose:g,children:e.jsx(de,{value:E,children:e.jsx(le,{dateAdapter:me,children:e.jsxs(ue,{autoComplete:"off",noValidate:!0,onSubmit:w,children:[e.jsx(he,{children:m?a.formatMessage({id:"services.vaccination.editServiceTitle"}):a.formatMessage({id:"services.vaccination.addServiceTitle"})}),e.jsx(q,{}),e.jsx(pe,{sx:{p:2.5},children:e.jsxs(u,{container:!0,spacing:3,children:[e.jsxs(u,{item:!0,xs:12,md:3,children:[e.jsxs(o,{direction:"row",justifyContent:"center",sx:{mt:3},children:[e.jsxs(ge,{htmlFor:"change-avtar",sx:{position:"relative",borderRadius:"50%",overflow:"hidden","&:hover .MuiBox-root":{opacity:1},cursor:"pointer"},children:[e.jsx(Z,{alt:"Avatar 1",src:B,sx:{width:72,height:72,border:"1px dashed"}}),e.jsx(ee,{sx:{position:"absolute",top:0,left:0,background:y.palette.mode===xe.DARK?"rgba(255, 255, 255, .75)":"rgba(0,0,0,.65)",width:"100%",height:"100%",opacity:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(o,{spacing:.5,alignItems:"center",children:[e.jsx(Pe,{style:{color:y.palette.secondary.lighter,fontSize:"2rem"}}),e.jsx(b,{sx:{color:"secondary.lighter"},children:a.formatMessage({id:"common.upload"})})]})})]}),e.jsx(v,{type:"file",id:"change-avtar",placeholder:"Outlined",variant:"outlined",inputProps:{accept:"image/*"},sx:{display:"none"},onChange:n=>{var f;W("image",!0),N((f=n.target.files)==null?void 0:f[0])}})]}),e.jsx(o,{direction:"row",justifyContent:"center",children:c.image&&i.image&&e.jsx(_,{error:!0,id:"helper-image",children:i==null?void 0:i.image})})]}),e.jsx(u,{item:!0,xs:12,md:8,children:e.jsxs(u,{container:!0,spacing:3,children:[e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"name_en",children:a.formatMessage({id:"services.vaccination.serviceNameEn"})}),e.jsx(v,{fullWidth:!0,id:"name_en",placeholder:a.formatMessage({id:"services.vaccination.serviceNameEn"}),...p("name_en"),error:!!(c.name_en&&i.name_en)})]}),c.name_en&&i.name_en&&e.jsx(_,{error:!0,id:"helper-name_en",children:i==null?void 0:i.name_en})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"name_ar",children:a.formatMessage({id:"services.vaccination.serviceNameAr"})}),e.jsx(v,{fullWidth:!0,id:"name_ar",placeholder:a.formatMessage({id:"services.vaccination.serviceNameAr"}),...p("name_ar"),error:!!(c.name_ar&&i.name_ar)})]}),c.name_ar&&i.name_ar&&e.jsx(_,{error:!0,id:"helper-name_ar",children:i==null?void 0:i.name_ar})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"description_en",children:a.formatMessage({id:"services.vaccinationDescEn"})}),e.jsx(v,{fullWidth:!0,multiline:!0,rows:3,id:"description_en",placeholder:a.formatMessage({id:"services.vaccinationDescEn"}),...p("description_en"),error:!!(c.description_en&&i.description_en)})]}),c.description_en&&i.description_en&&e.jsx(_,{error:!0,id:"helper-description_en",children:i==null?void 0:i.description_en})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"description_ar",children:a.formatMessage({id:"services.vaccinationDescAr"})}),e.jsx(v,{fullWidth:!0,multiline:!0,rows:3,id:"description_ar",placeholder:a.formatMessage({id:"services.vaccinationDescAr"}),...p("description_ar"),error:!!(c.description_ar&&i.description_ar)})]}),c.description_ar&&i.description_ar&&e.jsx(_,{error:!0,id:"helper-description_ar",children:i==null?void 0:i.description_ar})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"min_visit_price",children:a.formatMessage({id:"services.minVisitPrice"})}),e.jsx(v,{type:"number",fullWidth:!0,id:"min_visit_price",placeholder:a.formatMessage({id:"services.minVisitPrice"}),...p("min_visit_price"),error:!!(c.min_visit_price&&i.min_visit_price)})]}),c.min_visit_price&&i.min_visit_price&&e.jsx(_,{error:!0,id:"helper-min_visit_price",children:i==null?void 0:i.min_visit_price})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"min_service_price",children:a.formatMessage({id:"services.minServicePrice"})}),e.jsx(v,{type:"number",fullWidth:!0,id:"min_service_price",placeholder:a.formatMessage({id:"services.minServicePrice"}),...p("min_service_price"),error:!!(c.min_service_price&&i.min_service_price)})]}),c.min_service_price&&i.min_service_price&&e.jsx(_,{error:!0,id:"helper-min_service_price",children:i==null?void 0:i.min_service_price})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"discount",children:a.formatMessage({id:"services.discount"})}),e.jsx(v,{type:"number",fullWidth:!0,id:"discount",placeholder:a.formatMessage({id:"services.discount"}),...p("discount"),error:!!(c.discount&&i.discount)})]}),c.discount&&i.discount&&e.jsx(_,{error:!0,id:"helper-discount",children:i==null?void 0:i.discount})]}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{spacing:1,children:[e.jsx(S,{htmlFor:"consultant_duration",children:a.formatMessage({id:"services.serviceStatus"})}),e.jsx(je,{fullWidth:!0,children:e.jsxs(_e,{id:"status",displayEmpty:!0,value:F.status,onChange:n=>O("status",n.target.value),children:[e.jsx(T,{value:"",children:e.jsx("em",{children:a.formatMessage({id:"common.none"})})}),h==null?void 0:h.map(n=>e.jsx(T,{value:n.value,children:n.label[r]},n.value))]})})]}),c.status&&i.status&&e.jsx(_,{error:!0,id:"helper-status",children:i==null?void 0:i.status})]})]})})]})}),e.jsx(q,{}),e.jsx(fe,{sx:{p:2.5},children:e.jsx(u,{container:!0,justifyContent:"right",alignItems:"center",children:e.jsx(u,{item:!0,children:e.jsxs(o,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(z,{color:"error",onClick:g,children:a.formatMessage({id:"common.cancel"})}),e.jsx(ve,{type:"submit",loading:I,loadingIndicator:a.formatMessage({id:"common.processing"}),variant:"contained",children:m?a.formatMessage({id:"services.vaccination.editServiceTitle"}):a.formatMessage({id:"services.vaccination.addSubmitButton"})})]})})})})]})})})})})}function Je(t){return[{title:t.formatMessage({id:"sidebar.home"}),to:Be},{title:t.formatMessage({id:"services.vaccination.title"})}]}function ui(){const{lang:t}=X(),{data:m,error:A,isLoading:M,setSorting:g,setFilterCriteria:y,setPagination:a,url:h}=Re(Y.VACCINATION),r=$(),C=Q(),[N,B]=d.useState(!1),K=Se(C.breakpoints.down("sm")),[L,E]=d.useState(null),[i,c]=d.useState(0),[w,I]=d.useState(0),[p,F]=d.useState(0),[W,O]=d.useState(),{filter:n,search:f,setSearch:l}=Ue(),U=()=>{E(null),B(!0)},te=d.useCallback(async()=>{try{await Ve(i,h).then(s=>{k(r.formatMessage({id:"services.deletServiceSuccess"})),c(0)})}catch{c(0)}},[i,h,r]),se=d.useCallback(async()=>{try{await G(w,{status:V.Active},h).then(s=>{k(r.formatMessage({id:"services.activate.success"})),I(0)})}catch{I(0)}},[w,h,r]),ae=d.useCallback(async()=>{try{await G(p,{status:V.InActive},h).then(s=>{k(r.formatMessage({id:"services.deactivate.success"})),F(0)})}catch{F(0)}},[p,h,r]);d.useEffect(()=>{y(n)},[n]);const ne=d.useMemo(()=>[{header:r.formatMessage({id:"services.serviceName"}),accessorKey:"name",enableSorting:!1,cell:({row:s})=>e.jsxs(o,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(Z,{alt:"Avatar 1",size:"sm",src:s.original.image}),e.jsx(o,{spacing:0,children:e.jsx(b,{variant:"subtitle1",children:s.original.name[t]})})]})},{header:r.formatMessage({id:"services.medicalCenters"}),accessorKey:"medical_centers_count",cell:({row:s})=>e.jsx(J,{className:"typography-inline",value:s.original.hospitals_count})},{header:r.formatMessage({id:"common.visits"}),accessorKey:"visits_count",disableSortBy:!0,cell:({row:s})=>e.jsx(J,{className:"typography-inline",value:s.original.visits_count})},{header:r.formatMessage({id:"common.status"}),accessorKey:"status",cell:({row:s})=>e.jsx(Me,{status:s.original.status,referenceKey:ie.SERVICES_STATUS})},{header:r.formatMessage({id:"common.createdOn"}),accessorKey:"created_at",cell:({row:s})=>{var x;return Ee((x=s.original)==null?void 0:x.created_at).format(ye)}},{header:r.formatMessage({id:"common.actions"}),accessorKey:"Actions",meta:{className:"cell-center"},enableSorting:!1,cell:({row:s})=>{const[x,D]=d.useState(null),R=!!x,P=j=>{D(j.currentTarget)},H=()=>{D(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{onClick:P,children:e.jsx(be,{})}),e.jsxs(Ae,{anchorEl:x,open:R,onClose:H,onClick:H,children:[e.jsx(T,{onClick:j=>{j.stopPropagation(),B(!0),E(s.original)},children:e.jsx(b,{variant:"body1",children:r.formatMessage({id:"services.vaccination.editServiceTitle"})})}),s.original.status===V.Active&&e.jsx(T,{onClick:j=>{j.stopPropagation(),F(s.original.id)},children:e.jsx(b,{variant:"body1",children:r.formatMessage({id:"services.deactivate.action"})})}),s.original.status===V.InActive&&e.jsx(T,{onClick:j=>{j.stopPropagation(),I(s.original.id)},children:e.jsx(b,{variant:"body1",children:r.formatMessage({id:"services.activate.action"})})}),e.jsx(T,{onClick:j=>{j.stopPropagation(),c(s.original.id)},children:e.jsx(b,{variant:"body1",children:r.formatMessage({id:"services.vaccination.deleteServiceTitle"})})})]})]})}}],[]);return d.useEffect(()=>{De().then(s=>{var D,R;const x=(R=(D=s==null?void 0:s.data)==null?void 0:D.data)==null?void 0:R.find(P=>(P==null?void 0:P.slug)==="vaccination");O(x==null?void 0:x.id)})},[]),e.jsxs(e.Fragment,{children:[e.jsx(Ie,{custom:!0,links:Je(r)}),e.jsxs(o,{direction:"row",marginBottom:"20px",spacing:2,justifyContent:"space-between",alignItems:"center",children:[e.jsx(b,{variant:"h2",children:r.formatMessage({id:"services.vaccination.title"})}),e.jsx(z,{variant:"contained",startIcon:e.jsx(ze,{}),onClick:U,children:r.formatMessage({id:"services.vaccination.addServiceTitle"})})]}),e.jsx(Fe,{data:m,columns:ne,isLoading:M,setPagination:s=>{a(s)},setSortingParams:s=>{g(s)},children:e.jsx(Te,{content:!1,children:e.jsxs(o,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",justifyContent:"space-between",sx:{padding:2,...K&&{"& .MuiOutlinedInput-root, & .MuiFormControl-root":{width:"100%"}}},children:[e.jsx(ee,{sx:{width:{xs:"70%",md:"70%"}},children:e.jsx(o,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(we,{value:f,onFilterChange:s=>l(s),placeholder:r.formatMessage({id:"services.vaccination.searchService"})})})}),e.jsx(o,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{width:{xs:"100%",sm:"auto"}},children:e.jsx(o,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(z,{variant:"outlined",startIcon:e.jsx(Ge,{}),children:r.formatMessage({id:"common.export"})})})})]})})}),N&&e.jsx(qe,{open:N,serviceId:W,handleClose:()=>{B(!1)},url:h,subService:L}),!!i&&e.jsx(Ke,{open:!!i,handleSubmit:te,handleClose:()=>{c(0)}}),e.jsx(Le,{open:!!p,handleSubmit:ae,handleClose:()=>{F(0)}}),e.jsx(We,{open:!!w,handleSubmit:se,handleClose:()=>{I(0)}})]})}export{ui as default};
