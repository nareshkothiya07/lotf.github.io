import{b1 as R,W as P,t as U,u as L,r as u,j as e,T as s,J as N,G as a,ag as k,ah as T,y as A,b5 as c,bv as G,as as I,bw as Y,bx as z,by as j,bz as o,bA as V,U as H}from"./index-DSO9TgYq.js";import{d as g}from"./dayjs.min-pRfd56nx.js";import{u as W,a as J}from"./finance-FNhwWqHi.js";function O(d,h){return[{title:d.formatMessage({id:"sidebar.home"}),to:H},{title:d.formatMessage({id:"finance.providersSettlement"}),to:"/finance/settlement/providers"},{title:d.formatMessage({id:"common.detail"})}]}function X(){var f,p,v;const{id:d}=R();P();const{lang:h}=U(),n=L(),{data:m,error:B,isLoading:S}=W("provider",!0),[t,C]=u.useState(null),x=t&&t.week_start&&t.week_end&&t.hospital_id,E=u.useMemo(()=>x?{week_start:t.week_start,week_end:t.week_end,hospital_id:t.hospital_id}:{},[x,t==null?void 0:t.week_start,t==null?void 0:t.week_end,t==null?void 0:t.hospital_id]),{data:i,error:$,isLoading:F}=J("provider",x?E:null);if(u.useEffect(()=>{if(m!=null&&m.data&&d){const r=parseInt(d)-1,l=m.data[r];l&&C(l)}},[m,d]),S)return e.jsx(s,{children:"Loading..."});if(B)return e.jsx(s,{children:"Error loading settlement data"});if(!t)return e.jsx(s,{children:"Settlement not found"});const y=t.hospital_name?t.hospital_name[h]||((f=t.hospital_name)==null?void 0:f.en):"Unknown Provider";return e.jsxs(e.Fragment,{children:[e.jsx(N,{custom:!0,links:O(n)}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(k,{children:e.jsxs(T,{children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:y}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"common.weekly"})}),e.jsxs(s,{children:[g(t.week_start).format(A)," - ",g(t.week_end).format(A)]})]}),e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"common.provider"})}),e.jsx(s,{children:t.hospital_id})]}),e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"finance.transactionCount"})}),e.jsx(c,{label:((p=i==null?void 0:i.data)==null?void 0:p.length)||t.transaction_count||0})]}),e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"finance.totalAmountVisits"})}),e.jsxs(s,{variant:"h5",children:[t.total_amount||0," SAR"]})]}),e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"finance.providerCommission"})}),e.jsxs(s,{variant:"h5",children:[((t.total_amount||0)*.8).toFixed(2)," SAR"]})]}),e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"finance.lotfCommission"})}),e.jsxs(s,{variant:"h5",children:[((t.total_amount||0)*.2).toFixed(2)," SAR"]})]}),(i==null?void 0:i.data)&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"finance.refundsCount"})}),e.jsx(c,{label:i.data.filter(r=>r.status==="REFUNDED").length})]}),e.jsxs(a,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:n.formatMessage({id:"finance.refundAmount"})}),e.jsxs(s,{variant:"h5",children:[i.data.filter(r=>r.status==="REFUNDED").reduce((r,l)=>r+(parseFloat(l.total_amount)||0),0).toFixed(2)," SAR"]})]})]})]})]})})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(k,{children:e.jsxs(T,{children:[e.jsx(s,{variant:"h5",gutterBottom:!0,children:n.formatMessage({id:"finance.transactionDetails"})}),e.jsx(G,{component:I,variant:"outlined",children:e.jsxs(Y,{children:[e.jsx(z,{children:e.jsxs(j,{children:[e.jsx(o,{children:e.jsx("strong",{children:n.formatMessage({id:"common.date"})})}),e.jsx(o,{children:e.jsx("strong",{children:n.formatMessage({id:"common.service"})})}),e.jsx(o,{children:e.jsx("strong",{children:n.formatMessage({id:"common.patient"})})}),e.jsx(o,{align:"right",children:e.jsx("strong",{children:n.formatMessage({id:"common.amount"})})}),e.jsx(o,{children:e.jsx("strong",{children:n.formatMessage({id:"common.status"})})})]})}),e.jsxs(V,{children:[(v=i==null?void 0:i.data)==null?void 0:v.map((r,l)=>{var _,b,M,w;return e.jsxs(j,{children:[e.jsx(o,{children:g(r.created_at).format("DD-MM-YYYY")}),e.jsx(o,{children:e.jsx(c,{label:((_=r.visit)==null?void 0:_.visit_type)||"Visit",size:"small"})}),e.jsx(o,{children:(b=r.patient)!=null&&b.name?typeof r.patient.name=="object"?r.patient.name[h]||((M=r.patient.name)==null?void 0:M.en)||"Unknown Patient":r.patient.name:`Patient ${((w=r.patient)==null?void 0:w.id)||"Unknown"}`}),e.jsxs(o,{align:"right",children:[r.total_amount||0," SAR"]}),e.jsx(o,{children:e.jsx(c,{label:r.status||"Unknown",size:"small"})})]},r.id||l)}),(!(i!=null&&i.data)||i.data.length===0)&&e.jsx(j,{children:e.jsx(o,{colSpan:5,align:"center",children:e.jsx(s,{color:"text.secondary",children:F?"Loading transactions...":"No transactions found"})})})]})]})})]})})})]})]})}export{X as default};
