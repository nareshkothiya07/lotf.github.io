import{a as ie,u as G,r as n,g as pe,b as xe,a$ as ge,c as K,j as e,C as re,F as fe,L as je,A as ve,d as Me,D as oe,e as V,f as ne,G as d,S as c,h as ye,i as Se,B as J,k as Ce,T as M,l as N,m as _,I,aC as be,N as we,aJ as Ae,aK as le,b0 as de,H as y,p as ce,q as T,s as _e,X as Ie,t as Fe,W as Ee,v as Re,R as ke,x as ee,y as te,z as Pe,M as Te,E as Be,J as De,K as Oe,U as Ne}from"./index-DSO9TgYq.js";import{d as se}from"./dayjs.min-pRfd56nx.js";import{D as Le}from"./DebouncedInput-DhmfX_1V.js";import{u as Ke}from"./useFilterAndSearch-PJD0Zg8P.js";import{C as L}from"./CustomTypography-CRnDvUFn.js";import{C as Ve}from"./CameraOutlined-D4Mj0cXe.js";import{c as me}from"./role-NGsUuE4A.js";import{a as Ue,b as We,u as He,c as ae,d as ze}from"./administrator-DTa7ROU2.js";import{P as $e}from"./react-number-format.es-Bl0F5VJY.js";import{E as Ge}from"./EyeOutlined-ChV9zO9W.js";import{E as Je}from"./EyeInvisibleOutlined-CaFaFVHk.js";import{E as qe}from"./EditStatusDialog-BIVGlZRP.js";import{u as Qe}from"./useStatusList-Dbp-x5Xm.js";import{D as Xe}from"./DeleteConfirmation-BqFOMagf.js";import{P as Ye}from"./PlusOutlined-BQvVSxI0.js";import{A as Ze}from"./ArrowUpOutlined-C9GTlrEN.js";import"./CloseOutlined-DRBnXhIJ.js";import"./regex-AjllrUCH.js";import"./ConfirmationDialog-DR_Ho8RD.js";import"./Dialog-CPoUMqzk.js";const et=s=>{const f={first_name:"",email:"",phone:"",password:"",role_id:"",photo:""};return s?{first_name:s==null?void 0:s.first_name,email:s==null?void 0:s.email,phone:Ie(s==null?void 0:s.phone),password:s==null?void 0:s.password,role_id:s==null?void 0:s.role_id,photo:s==null?void 0:s.photo}:f};function tt({admin:s,url:f,open:F,handleClose:h}){const S=ie(),o=G(),[C,E]=n.useState([]),[a,R]=n.useState(!1),[l,b]=n.useState(void 0),[p,v]=n.useState(`${s&&(s!=null&&s.photo)?s.photo:""}`),U=()=>{R(!a)},B=r=>{r.preventDefault()};n.useEffect(()=>{l&&(v(URL.createObjectURL(l)),pe(l,r=>{O("photo",r)}))},[l]);const D=n.useMemo(()=>et(s),[]),w=xe({initialValues:D,validationSchema:Ue(o),enableReinitialize:!0,onSubmit:async(r,{setSubmitting:x})=>{try{let P={...r,phone:ge(r==null?void 0:r.phone)};await We(P,f).then(q=>{K(o.formatMessage({id:"administrative.addSuccess"})),x(!1),h()})}catch(P){console.error(P),x(!1)}}});n.useEffect(()=>{me().then(r=>{var x;E((x=r==null?void 0:r.data)==null?void 0:x.data)})},[]);const{errors:i,touched:u,handleSubmit:W,isSubmitting:k,getFieldProps:A,handleChange:H,values:j,handleBlur:z,setFieldTouched:$,setFieldValue:O}=w;return e.jsx(e.Fragment,{children:F&&e.jsx(re,{open:F,handleClose:h,children:e.jsx(fe,{value:w,children:e.jsx(je,{dateAdapter:ve,children:e.jsxs(Me,{autoComplete:"off",noValidate:!0,onSubmit:W,children:[e.jsx(oe,{children:s?o.formatMessage({id:"administrative.editAdmin"}):o.formatMessage({id:"administrative.addNewAdmin"})}),e.jsx(V,{}),e.jsx(ne,{sx:{p:2.5},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:3,children:[e.jsxs(c,{direction:"row",justifyContent:"center",sx:{mt:3},children:[e.jsxs(ye,{htmlFor:"change-avtar",sx:{position:"relative",borderRadius:"50%",overflow:"hidden","&:hover .MuiBox-root":{opacity:1},cursor:"pointer"},children:[e.jsx(Se,{alt:"Avatar 1",src:p,sx:{width:72,height:72,border:"1px dashed"}}),e.jsx(J,{sx:{position:"absolute",top:0,left:0,background:S.palette.mode===Ce.DARK?"rgba(255, 255, 255, .75)":"rgba(0,0,0,.65)",width:"100%",height:"100%",opacity:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(c,{spacing:.5,alignItems:"center",children:[e.jsx(Ve,{style:{color:S.palette.secondary.lighter,fontSize:"2rem"}}),e.jsx(M,{sx:{color:"secondary.lighter"},children:o.formatMessage({id:"common.upload"})})]})})]}),e.jsx(N,{type:"file",id:"change-avtar",placeholder:"Outlined",variant:"outlined",inputProps:{accept:"image/*"},sx:{display:"none"},onChange:r=>{var x;$("photo",!0),b((x=r.target.files)==null?void 0:x[0])}})]}),e.jsx(c,{direction:"row",justifyContent:"center",children:u.photo&&i.photo&&e.jsx(_,{error:!0,id:"helper-photo",children:i==null?void 0:i.photo})})]}),e.jsx(d,{item:!0,xs:12,md:8,children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{spacing:1,children:[e.jsx(I,{htmlFor:"first_name",children:o.formatMessage({id:"administrative.adminName"})}),e.jsx(N,{fullWidth:!0,id:"first_name",placeholder:o.formatMessage({id:"administrative.adminName"}),...A("first_name"),error:!!(u.first_name&&i.first_name)})]}),u.first_name&&i.first_name&&e.jsx(_,{error:!0,id:"helper-first_name",children:i==null?void 0:i.first_name})]}),e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{spacing:1,children:[e.jsx(I,{htmlFor:"email",children:o.formatMessage({id:"profile.email"})}),e.jsx(N,{fullWidth:!0,id:"email",placeholder:o.formatMessage({id:"profile.email"}),...A("email"),error:!!(u.email&&i.email)})]}),u.email&&i.email&&e.jsx(_,{error:!0,id:"helper-email",children:i==null?void 0:i.email})]}),e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{spacing:1,children:[e.jsx(I,{htmlFor:"phone",children:o.formatMessage({id:"profile.phoneNo"})}),e.jsx($e,{id:"phone",name:"phone",format:"+### ## ### ####",mask:"_",placeholder:"+966 5",value:j.phone,onValueChange:r=>w.setFieldValue("phone",r.formattedValue),onBlur:w.handleBlur,customInput:N})]}),u.phone&&i.phone&&e.jsx(_,{error:!0,id:"helper-phone",children:i==null?void 0:i.phone})]}),e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{spacing:1,children:[e.jsx(I,{htmlFor:"password",children:o.formatMessage({id:"common.password"})}),e.jsx(be,{id:"password",placeholder:o.formatMessage({id:"common.password"}),type:a?"text":"password",value:j.password,name:"password",onBlur:z,onChange:H,endAdornment:e.jsx(we,{position:"end",children:e.jsx(Ae,{"aria-label":"toggle password visibility",onClick:U,onMouseDown:B,edge:"end",size:"large",color:"secondary",children:a?e.jsx(Ge,{}):e.jsx(Je,{})})})})]}),u.password&&i.password&&e.jsx(_,{error:!0,id:"password-helper",children:i.password})]}),e.jsxs(d,{item:!0,xs:6,sm:6,children:[e.jsxs(c,{spacing:1,children:[e.jsx(I,{htmlFor:"role",children:o.formatMessage({id:"common.role"})}),e.jsx(le,{fullWidth:!0,error:!!(u.role_id&&i.role_id),children:e.jsxs(de,{id:"role_id",displayEmpty:!0,value:j==null?void 0:j.role_id,onChange:r=>{O("role_id",r.target.value)},children:[e.jsx(y,{value:"",disabled:!0,children:e.jsx(M,{color:"secondary",children:o.formatMessage({id:"common.selectOp"})})}),C.map(r=>e.jsx(y,{value:r.id,children:r.name},r.id))]})})]}),u.role_id&&i.role_id&&e.jsx(_,{error:!0,id:"role_id-helper",children:i.role_id})]})]})})]})}),e.jsx(V,{}),e.jsx(ce,{sx:{p:2.5},children:e.jsx(d,{container:!0,justifyContent:"right",alignItems:"center",children:e.jsx(d,{item:!0,children:e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(T,{color:"error",onClick:h,children:o.formatMessage({id:"common.cancel"})}),e.jsx(_e,{type:"submit",loading:k,loadingIndicator:o.formatMessage({id:"common.processing"}),variant:"contained",children:s?o.formatMessage({id:"administrative.editAdmin"}):o.formatMessage({id:"administrative.addAdmin"})})]})})})})]})})})})})}function st({title:s,open:f,roleId:F,rolesList:h,handleSubmit:S,handleClose:o}){const[C,E]=n.useState(String(F)),a=G(),R=()=>{S(Number(C))};return e.jsx(e.Fragment,{children:f&&e.jsxs(re,{open:f,handleClose:o,maxWidth:500,children:[e.jsx(oe,{children:s}),e.jsx(V,{}),e.jsx(ne,{sx:{p:2.5},children:e.jsx(d,{container:!0,spacing:1,children:e.jsx(d,{item:!0,xs:12,md:12,children:e.jsxs(c,{spacing:1,children:[e.jsx(I,{htmlFor:"role",children:a.formatMessage({id:"common.role"})}),e.jsx(le,{fullWidth:!0,children:e.jsx(de,{id:"role",value:C??0,onChange:l=>E(l.target.value),children:(h??[]).map(l=>e.jsx(y,{value:l.id,children:l.name},l.id))})})]})})})}),e.jsx(V,{}),e.jsx(ce,{sx:{p:2.5},children:e.jsx(d,{container:!0,justifyContent:"right",alignItems:"center",children:e.jsx(d,{item:!0,md:12,children:e.jsxs(J,{display:"flex",gap:2,justifyContent:"flex-end",children:[e.jsx(T,{color:"error",onClick:o,children:a.formatMessage({id:"common.cancel"})}),e.jsx(T,{type:"button",variant:"contained",onClick:R,children:a.formatMessage({id:"common.update"})})]})})})})]})})}function at(s){return[{title:s.formatMessage({id:"sidebar.home"}),to:Ne},{title:s.formatMessage({id:"sidebar.administrative"})}]}function bt(){var Q;Fe();const s=Ee(),{data:f,error:F,url:h,isLoading:S,setSorting:o,setPagination:C,setFilterCriteria:E}=He(),a=G(),R=ie(),[l,b]=n.useState(null),[p,v]=n.useState(null),U=Re(R.breakpoints.down("sm")),[B,D]=n.useState(!1),[w,i]=n.useState(null),[u,W]=n.useState([]),[k,A]=n.useState(0),{defaultList:H}=Qe(ee.DOCTOR_STATUS),{filter:j,search:z,setSearch:$}=Ke();n.useEffect(()=>{E(j)},[j]);const O=()=>{i(null),D(!0)},r=n.useCallback(t=>{l&&ae(l.id,h,{status:t}).then(()=>{K(a.formatMessage({id:"administrative.statusEditSuccess"})),b(null)}).catch(()=>{b(null)})},[l,a,h]),x=n.useCallback(t=>{p&&ae(p.id,h,{role_id:t}).then(()=>{K(a.formatMessage({id:"administrative.statusEditRoleSuccess"})),v(null)}).catch(()=>{v(null)})},[p,a,h]),P=n.useCallback(async()=>{try{await ze(k,h).then(()=>{K(a.formatMessage({id:"administrative.deleteSuccess"})),A(0)})}catch{A(0)}},[k,h,a]),q=n.useMemo(()=>[{header:a.formatMessage({id:"administrative.adminName"}),accessorKey:"first_name",cell:({row:t})=>e.jsx(L,{className:"typography-inline",value:t.original.first_name})},{header:a.formatMessage({id:"profile.phoneNo"}),accessorKey:"phone",enableSorting:!1,cell:({row:t})=>e.jsx(L,{className:"typography-inline",value:t.original.phone})},{header:a.formatMessage({id:"profile.email"}),accessorKey:"email",enableSorting:!1,cell:({row:t})=>e.jsx(L,{className:"typography-inline",value:t.original.email})},{header:a.formatMessage({id:"common.status"}),accessorKey:"status",cell:t=>e.jsx(ke,{status:t.getValue(),referenceKey:ee.DOCTOR_STATUS})},{header:a.formatMessage({id:"common.role"}),accessorKey:"role",cell:({row:t})=>{var m;return e.jsx(L,{className:"typography-inline",value:(m=t.original.roles[0])==null?void 0:m.name})}},{header:a.formatMessage({id:"common.joinedon"}),accessorKey:"created_at",cell:({row:t})=>{var m;return se((m=t.original)==null?void 0:m.created_at).format(te)}},{header:a.formatMessage({id:"common.lastActive"}),accessorKey:"last_activity",cell:({row:t})=>{var m;return se((m=t.original)==null?void 0:m.last_activity).format(te)}},{header:a.formatMessage({id:"common.actions"}),accessorKey:"Actions",meta:{className:"cell-center"},enableSorting:!1,cell:({row:t})=>{const[m,X]=n.useState(null),he=!!m,ue=g=>{X(g.currentTarget)},Y=()=>{X(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{onClick:ue,children:e.jsx(Te,{})}),e.jsxs(Be,{anchorEl:m,open:he,onClose:Y,onClick:Y,children:[e.jsx(y,{onClick:g=>{var Z;g.stopPropagation(),s(`/administrater/${(Z=t==null?void 0:t.original)==null?void 0:Z.id}`)},children:e.jsx(M,{variant:"body1",children:a.formatMessage({id:"administrative.editInfo"})})}),e.jsx(y,{onClick:g=>{g.stopPropagation(),v(t==null?void 0:t.original)},children:e.jsx(M,{variant:"body1",children:a.formatMessage({id:"administrative.changeRole"})})}),e.jsx(y,{onClick:g=>{g.stopPropagation(),v(t.original.id)},children:e.jsx(M,{variant:"body1",children:a.formatMessage({id:"administrative.deleteAdmin"})})}),e.jsx(y,{onClick:g=>{g.stopPropagation(),b(t.original)},children:e.jsx(M,{variant:"body1",children:a.formatMessage({id:"common.editStatus"})})})]})]})}}],[]);return n.useEffect(()=>{me().then(t=>{var m;W((m=t==null?void 0:t.data)==null?void 0:m.data)})},[]),e.jsxs(e.Fragment,{children:[e.jsx(De,{custom:!0,links:at(a)}),e.jsxs(c,{direction:"row",marginBottom:"20px",spacing:2,justifyContent:"space-between",alignItems:"center",children:[e.jsx(M,{variant:"h2",children:a.formatMessage({id:"sidebar.administrative"})}),e.jsx(T,{variant:"contained",startIcon:e.jsx(Ye,{}),onClick:O,children:a.formatMessage({id:"administrative.addNewAdmin"})})]}),e.jsx(Oe,{data:f,columns:q,isLoading:S,setPagination:t=>{C(t)},setSortingParams:t=>{o(t)},children:e.jsxs(c,{direction:{xs:"column",sm:"row"},alignItems:"center",justifyContent:"space-between",sx:{px:2,paddingTop:2,...U&&{"& .MuiOutlinedInput-root, & .MuiFormControl-root":{width:"100%"}}},children:[e.jsx(J,{sx:{width:{xs:"70%",md:"70%"},mb:2},children:e.jsx(c,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(Le,{value:z,onFilterChange:t=>$(t),placeholder:a.formatMessage({id:"administrative.searchPlaceholder"})})})}),e.jsx(c,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",sx:{width:{xs:"100%",sm:"auto"}},children:e.jsx(c,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(T,{variant:"outlined",startIcon:e.jsx(Ze,{}),children:a.formatMessage({id:"common.export"})})})})]})}),B&&e.jsx(tt,{open:B,url:h,handleClose:()=>{D(!1)},admin:w}),e.jsx(Xe,{open:!!k,handleSubmit:P,handleClose:()=>{A(0)}}),l&&e.jsx(qe,{title:a.formatMessage({id:"administrative.editTitle"}),open:!!l,statusList:H,status:l==null?void 0:l.status,handleSubmit:r,handleClose:()=>{b(null)}}),p&&e.jsx(st,{title:a.formatMessage({id:"administrative.changeRole"}),open:!!p,rolesList:u,roleId:(Q=p==null?void 0:p.roles[0])==null?void 0:Q.id,handleSubmit:x,handleClose:()=>{v(0)}})]})}export{bt as default};
