import{b1 as R,W as L,t as I,u as O,r as x,j as e,T as n,J as P,G as o,ag as k,ah as v,y as A,b5 as m,bv as G,as as Y,bw as z,bx as H,by as j,bz as i,bA as D,U as V}from"./index-DSO9TgYq.js";import{d as g}from"./dayjs.min-pRfd56nx.js";import{u as W,a as J}from"./finance-FNhwWqHi.js";function $(d,u){return[{title:d.formatMessage({id:"sidebar.home"}),to:V},{title:d.formatMessage({id:"finance.doctorsSettlement"}),to:"/finance/settlement/doctors"},{title:d.formatMessage({id:"common.detail"})}]}function Z(){var f,p,_,b,T,C;const{id:d}=R();L();const{lang:u}=I(),a=O(),{data:c,error:E,isLoading:U}=W("doctor",!0),[t,y]=x.useState(null),h=t&&t.week_start&&t.week_end&&((f=t.doctor)==null?void 0:f.id),N=x.useMemo(()=>h?{week_start:t.week_start,week_end:t.week_end,doctor_id:t.doctor.id}:{},[h,t==null?void 0:t.week_start,t==null?void 0:t.week_end,(p=t==null?void 0:t.doctor)==null?void 0:p.id]),{data:r,error:q,isLoading:B}=J("doctor",h?N:null);if(x.useEffect(()=>{if(c!=null&&c.data&&d){const s=parseInt(d)-1,l=c.data[s];l&&y(l)}},[c,d]),U)return e.jsx(n,{children:"Loading..."});if(E)return e.jsx(n,{children:"Error loading settlement data"});if(!t)return e.jsx(n,{children:"Settlement not found"});const F=(_=t.doctor)!=null&&_.name?t.doctor.name[u]||((b=t.doctor.name)==null?void 0:b.en):"Unknown Doctor";return e.jsxs(e.Fragment,{children:[e.jsx(P,{custom:!0,links:$(a)}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{variant:"h4",gutterBottom:!0,children:F}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"common.weekly"})}),e.jsxs(n,{children:[g(t.week_start).format(A)," - ",g(t.week_end).format(A)]})]}),e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"finance.transactionCount"})}),e.jsx(m,{label:((T=r==null?void 0:r.data)==null?void 0:T.length)||t.transaction_count||0})]}),e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"finance.totalAmountVisits"})}),e.jsxs(n,{variant:"h5",children:[t.total_amount||0," SAR"]})]}),e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"finance.doctorCommision"})}),e.jsxs(n,{variant:"h5",children:[((t.total_amount||0)*.7).toFixed(2)," SAR"]})]}),e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"finance.lotfCommission"})}),e.jsxs(n,{variant:"h5",children:[((t.total_amount||0)*.3).toFixed(2)," SAR"]})]}),(r==null?void 0:r.data)&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"finance.refundsCount"})}),e.jsx(m,{label:r.data.filter(s=>s.status==="REFUNDED").length})]}),e.jsxs(o,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a.formatMessage({id:"finance.refundAmount"})}),e.jsxs(n,{variant:"h5",children:[r.data.filter(s=>s.status==="REFUNDED").reduce((s,l)=>s+(parseFloat(l.total_amount)||0),0).toFixed(2)," SAR"]})]})]})]})]})})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{variant:"h5",gutterBottom:!0,children:a.formatMessage({id:"finance.transactionDetails"})}),e.jsx(G,{component:Y,variant:"outlined",children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsxs(j,{children:[e.jsx(i,{children:e.jsx("strong",{children:a.formatMessage({id:"common.date"})})}),e.jsx(i,{children:e.jsx("strong",{children:a.formatMessage({id:"common.type"})})}),e.jsx(i,{children:e.jsx("strong",{children:a.formatMessage({id:"common.patient"})})}),e.jsx(i,{align:"right",children:e.jsx("strong",{children:a.formatMessage({id:"common.amount"})})}),e.jsx(i,{children:e.jsx("strong",{children:a.formatMessage({id:"common.status"})})})]})}),e.jsxs(D,{children:[(C=r==null?void 0:r.data)==null?void 0:C.map((s,l)=>{var M,S,w;return e.jsxs(j,{children:[e.jsx(i,{children:g(s.created_at).format("DD-MM-YYYY")}),e.jsx(i,{children:e.jsx(m,{label:s.transaction_type==="CONSULTATION"?"Consultation":s.transaction_type==="URGENT_CONSULTATION"?"Urgent Consultation":s.transaction_type==="SCHEDULED_CONSULTATION"?"Scheduled Consultation":"Consultation",size:"small"})}),e.jsx(i,{children:(M=s.patient)!=null&&M.name?typeof s.patient.name=="object"?s.patient.name[u]||((S=s.patient.name)==null?void 0:S.en)||"Unknown Patient":s.patient.name:`Patient ${((w=s.patient)==null?void 0:w.id)||"Unknown"}`}),e.jsxs(i,{align:"right",children:[s.total_amount||0," SAR"]}),e.jsx(i,{children:e.jsx(m,{label:s.status||"Unknown",size:"small"})})]},s.id||l)}),(!(r!=null&&r.data)||r.data.length===0)&&e.jsx(j,{children:e.jsx(i,{colSpan:5,align:"center",children:e.jsx(n,{color:"text.secondary",children:B?"Loading transactions...":"No transactions found"})})})]})]})})]})})})]})]})}export{Z as default};
